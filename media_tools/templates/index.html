{% extends "base.html" %}

{% block title %}Image Converter and Resizer{% endblock %}

{% block content %}
    <h1>Image Converter and Resizer</h1>
    <form action="{{ url_for('convert') }}" method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label for="file">Select Image:</label>
            <input type="file" id="file" name="file" accept=".png,.jpg,.jpeg,.gif,.webp,.bmp">
        </div>

        <div class="form-group">
            <label for="format">Convert to:</label>
            <select id="format" name="format">
                <option value="png">PNG</option>
                <option value="jpg">JPG</option>
                <option value="webp">WebP</option>
                <option value="gif">GIF</option>
                <option value="bmp">BMP</option>
            </select>
        </div>

        <div id="format-options" class="form-group">
            <!-- Format-specific options will be shown here -->
        </div>

        <div class="toggle-container">
            <label>
                <input type="checkbox" id="resize-toggle"> Resize image
            </label>
        </div>

        <div id="resize-options" class="form-group hidden">
            <input type="hidden" name="resize" id="resize" value="no">
            <div class="form-group">
                <label for="width">Width (px):</label>
                <input type="number" id="width" name="width" placeholder="Leave empty to maintain aspect ratio">
            </div>
            <div class="form-group">
                <label for="height">Height (px):</label>
                <input type="number" id="height" name="height" placeholder="Leave empty to maintain aspect ratio">
            </div>
        </div>

        <div class="form-group">
            <button type="submit">Convert & Download</button>
        </div>
    </form>
{% endblock %}

{% block scripts %}
<script>
    // Handle format options
    const formatSelect = document.getElementById('format');
    const formatOptions = document.getElementById('format-options');

    function updateFormatOptions() {
        const format = formatSelect.value;
        let optionsHTML = '';

        if (format === 'jpg' || format === 'webp') {
            optionsHTML = `
                <label for="quality">Quality (1-100):</label>
                <input type="number" id="quality" name="quality" value="85" min="1" max="100">
            `;
        } else if (format === 'png') {
            optionsHTML = `
                <label for="compression">Compression Level (0-9):</label>
                <input type="number" id="compression" name="compression" value="6" min="0" max="9">
            `;
        }

        formatOptions.innerHTML = optionsHTML;
    }

    formatSelect.addEventListener('change', updateFormatOptions);
    updateFormatOptions();

    // Handle resize toggle
    const resizeToggle = document.getElementById('resize-toggle');
    const resizeOptions = document.getElementById('resize-options');
    const resizeInput = document.getElementById('resize');

    resizeToggle.addEventListener('change', function() {
        if (this.checked) {
            resizeOptions.classList.remove('hidden');
            resizeInput.value = 'yes';
        } else {
            resizeOptions.classList.add('hidden');
            resizeInput.value = 'no';
        }
    });
</script>
{% endblock %}